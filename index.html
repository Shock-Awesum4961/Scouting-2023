<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="canonical" href="https://shock-awesum4961.github.io/Scouting-2023/" />

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="manifest" href="src/manifest.json">
    <meta name="apple-mobile-web-app-status-bar" content="#db4938">
    <meta name="theme-color" content="#db4938">
    <title>4961 Scouting</title>
  </head>
  <body>
    <main>
      <div class="main-container">
        <nav>
          <div class="nav nav-tabs w-100 nav-fill justify-content-center" id="nav-tab" role="tablist">
            <button class="nav-link nav-fill active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Home</button>
            <button class="nav-link nav-fill " id="nav-record-tab" data-bs-toggle="tab" data-bs-target="#nav-record" type="button" role="tab" aria-controls="nav-record" aria-selected="false" disabled>Match Scout</button>
            <button class="nav-link nav-fill " id="nav-pit-tab" data-bs-toggle="tab" data-bs-target="#nav-pit" type="button" role="tab" aria-controls="nav-pit" aria-selected="false" disabled>Pit Scout</button>
            <button class="nav-link nav-fill " id="nav-matches-tab" data-bs-toggle="tab" data-bs-target="#nav-matches" type="button" role="tab" aria-controls="nav-matches" aria-selected="false">Saved</button>
            <button class="nav-link nav-fill " id="nav-transfer-tab" data-bs-toggle="tab" data-bs-target="#nav-transfer" type="button" role="tab" aria-controls="nav-transfer" aria-selected="false" >Transfer</button>
            <button class="nav-link nav-fill " id="nav-analyze-tab" data-bs-toggle="tab" data-bs-target="#nav-analyze" type="button" role="tab" aria-controls="nav-analyze" aria-selected="false" >Analyze</button>
          </div>
        </nav>
        <div class="container">
          <div class="tab-content" id="nav-tabContent">
            <!-- Home Tab -->
            <div class="tab-pane show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab" tabindex="0">
              <div class=" mt-4">
                <h4 type="text" class="text-secondary text-center">4961 Scouting 2023</h4>
              </div>
              <div class="mt-4 mx-auto"style="width:70%">
                <input type="text" class="form-control" placeholder="Name (Required)" aria-label="Name" id="scout_name">
              </div>
              <div class=" mt-4 d-flex justify-content-around">
                <button class="btn btn-primary btn-lg" onclick="$('#nav-record-tab' ).trigger('click');saveScoutName();" id="startScouting" disabled>Match Scouting</button>
                <button class="btn btn-success btn-lg" onclick="$('#nav-pit-tab' ).trigger('click');saveScoutName();" id="pitScouting" disabled>Pit Scouting</button>
              </div>
            </div>

            <!-- Match Scouting Tab -->
            <div class="tab-pane" id="nav-record" role="tabpanel" aria-labelledby="nav-record-tab" tabindex="0">

              <!-- Match # / Team # / Alliance / Match Date / Match Type -->
              <div class="info-section mt-4" id="record-info">
                <h4>Match Details</h4>
                <div class="d-flex w-100 justify-content-around">

                  <div class="mb-3">
                    <label class="form-label" for="matchDate">Date</label>
                    <input class="form-control" type="date" name="matchDate" id="matchDate" placeholder="Match Date" disabled>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label" for="matchType">Type<span class="text-danger">*</span></label>
                    <select class="form-select" name="matchType" id="matchType">
                      <option value="" selected disabled class="text-secondary">Required</option>
                      <option value="Test" class="text-black">Test</option>
                      <option value="Practice" class="text-black">Practice</option>
                      <option value="Qualifications" class="text-black">Qualifications</option>
                      <option value="Semi-Finals" class="text-black">Semi-Finals</option>
                      <option value="Finals" class="text-black" >Finals</option>
                    </select>
                  </div>
                </div>

                <div class="d-flex  justify-content-around">
                  <div class="mb-2">
                    <label class="form-label" for="teamNumber">Match Number<span class="text-danger">*</span></label>
                    <input class="form-control" type="tel" name="matchNumber" id="matchNumber" placeholder="#" autocomplete="off">
                  </div>
                  <div class="mb-2">
                    <label class="form-label" for="teamNumber">Team Number<span class="text-danger">*</span></label>
                    <input class="form-control" type="tel" name="teamNumber" id="teamNumber" placeholder="#" autocomplete="off">
                  </div>
                </div>
                <div class="d-flex justify-content-center my-4">
                  <label class="form-check-label me-2" >Blue</label>
                  <label class="switch">
                    <input type="checkbox" id="allianceSwitch">
                    <span class="slider round"></span>
                  </label>
                  <label class="form-check-label ms-2" >Red</label>
                </div>
                <div class="d-flex justify-content-around my-2">
                  <button class="btn btn-danger" onclick="resetData()"; style="display:none;">Reset</button>
                  <button class="btn btn-primary" onclick="showAuton()"; id="continueMatchInfo" disabled>Continue</button>
                </div>

              </div>

              <!-- Timer Section -->
              <div class="timer-section mt-4 text-center" style="display:none">
                <div class="start-button">
                  <button class="btn btn-danger" onclick="startTimer()" id="startTimer">Start Match Timer</button>
                  <button class="btn btn-outline-secondary" onclick="stopTimer()" id="stopTimer" style="display:none"><img src="images/icons/pause-fill.svg"/></button>
                  <button class="btn btn-outline-secondary" onclick="resumeTimer()" id="resumeTimer" style="display:none"><img src="images/icons/play-fill.svg"/></button>
                  <button class="btn btn-outline-secondary" onclick="restartTimer()" id="restartRecording" style="display:none"><img src="images/icons/arrow-counterclockwise.svg" /></button>
                </div>
                <div class="countdown" style="display:none">
                  <div id="progressBar">
                    <div><span id="countdownTime" style="padding: 10px"></span></div>
                  </div>
                  Match Period: <span id="currentMatchPeriod" class="fw-bolder"></span> 
                </div>
                <hr>
              </div>



              <!-- Auton -->
              <div class="auton-section mt-4 text-center" id="record-auton" style="display:none">
                <h4>Auton Scoring</h4>
                <div class="d-flex w-100 justify-content-around">
                  <div class="me-2 flex-fill" style="margin-top:1.75rem!important">
                    <input type="checkbox" class="btn-check flex-fill " id="mobility" name="mobility" autocomplete="off">
                    <label class="btn btn-outline-success flex-fill " for="mobility">Mobility</label>
                  </div>
                  <div class="flex-grow-1 flex-fill">
                    <h6>Charger</h6>
                    <div class="btn-group" role="group" aria-label="Basic radio toggle button group" id="auton_charger_container">
                      <div class="btn-group-vertical flex-grow">
                        <input type="radio" class="btn-check" name="auton_charger" id="auton_docked" value="docked" autocomplete="off">
                        <label class="btn btn-outline-primary flex-fill " for="auton_docked">Docked</label>
                        <input type="radio" class="btn-check" name="auton_charger" id="auton_nocharger" value="no" autocomplete="off" checked>
                        <label class="btn btn-outline-warning flex-fill " for="auton_nocharger">No</label>
                      </div>
                      <div class="btn-group-vertical flex-grow">
                        <input type="radio" class="btn-check" name="auton_charger" id="auton_engaged" value="engaged" autocomplete="off">
                        <label class="btn btn-outline-primary flex-fill " for="auton_engaged">Engaged</label>
                        <input type="radio" class="btn-check" name="auton_charger" id="auton_failed" value="failed" autocomplete="off">
                        <label class="btn btn-outline-danger flex-fill " for="auton_failed">Failed</label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="btn-group-vertical flex-fill mt-4">
                  <div class="d-flex w-100">
                    <button class="btn btn-success btn-lg flex-fill" id="auton_top_cone">Cone Top</button>
                    <button class="btn btn-success btn-lg flex-fill" id="auton_top_cube">Cube Top</button>
                  </div>
                  <div class="d-flex w-100">
                    <button class="btn btn-warning btn-lg flex-fill" id="auton_mid_cone"> Cone Mid</button>
                    <button class="btn btn-warning btn-lg flex-fill" id="auton_mid_cube">Cube Mid</button>
                  </div>
                  <button class="btn btn-dark btn-lg flex-fill" id="auton_bot">Bottom</button>
                </div>
                <div class="d-flex mt-4 justify-content-between">
                  <button class="btn btn-primary" onclick="showInfo()">Back</button>
                  <button class="btn btn-primary" onclick="showTeleop()">Teleop</button>
                </div>
              </div>
            
            <!-- Tele-op -->
              <div class="teleop-section mt-4 text-center" id="record-teleop" style="display:none">
                <h4>Teleop Scoring</h4>
                <div class="">
                  <input type="checkbox" class="btn-check" id="teleop_defensive" name="teleop_defensive" autocomplete="off">
                  <label class="btn btn-outline-info " for="teleop_defensive">Defensive</label>
                </div>
                <div class=" mt-2">
                  <h4>Game Piece pick-up</h4>
                  <div class="d-flex w-100">
                    <button class="btn btn-secondary btn-lg flex-fill" id="teleop_pickup_portal_slide">Portal Slide</button>
                    <button class="btn btn-info btn-lg flex-fill" id="teleop_pickup_portal_shelf">Portal Shelf</button>
                    <button class="btn btn-warning btn-lg flex-fill" id="teleop_pickup_ground">Ground</button>
                  </div>
                </div>
                <div class=" mt-2">
                  <h4>Score</h4>
                  <div class="btn-group-vertical flex-fill">
                    <div class="d-flex w-100">
                      <button class="btn btn-success btn-lg flex-fill" id="teleop_top_cone">Cone Top</button>
                      <button class="btn btn-success btn-lg flex-fill" id="teleop_top_cube">Cube Top</button>
                    </div>
                    <div class="d-flex w-100">
                      <button class="btn btn-warning btn-lg flex-fill" id="teleop_mid_cone"> Cone Mid</button>
                      <button class="btn btn-warning btn-lg flex-fill" id="teleop_mid_cube">Cube Mid</button>
                    </div>
                    <button class="btn btn-dark btn-lg flex-fill" id="teleop_bot">Bottom</button>
                  </div>
                </div>
                <hr>
                <div class="mt-4">
                  <h4>Endgame</h4>
                  <div class="btn-group w-100" role="group" aria-label="Basic radio toggle button group" id="teleop_charger_container">
                    <div class="btn-group-vertical flex-fill">
                      <input type="radio" class="btn-check" name="teleop_charger" id="endgame_nocharger" value="no" autocomplete="off" checked>
                      <label class="btn btn-outline-warning  flex-fill " for="endgame_nocharger">No</label>
                      <input type="radio" class="btn-check" name="teleop_charger" id="endgame_failed" value="failed" autocomplete="off">
                      <label class="btn btn-outline-danger flex-fill " for="endgame_failed">Failed</label>
                    </div>

                    <input type="radio" class="btn-check" name="teleop_charger" id="endgame_community"  value="park" autocomplete="off">
                    <label class="btn btn-outline-primary  flex-fill " for="endgame_community">Park</label>
          
                    <input type="radio" class="btn-check" name="teleop_charger" id="endgame_docked" value="docked" autocomplete="off">
                    <label class="btn btn-outline-primary flex-fill " for="endgame_docked">Docked</label>
                    
                    <input type="radio" class="btn-check" name="teleop_charger" id="endgame_engaged" value="engaged" autocomplete="off">
                    <label class="btn btn-outline-primary flex-fill " for="endgame_engaged">Engaged</label>
                  </div>
                </div>
              <div class="form-floating mt-4">
                <textarea class="form-control" placeholder="Leave a comment here" id="comments" style="height: 100px"></textarea>
                <label for="comments">Comments</label>
              </div>
              <div class="d-flex justify-content-between mt-4">
                <div class="col"><button class="btn btn-primary" onclick="showAuton()">Auton</button></div>
                <div class="col"><button class="btn btn-primary" onclick="saveRecording()">Save</button></div>
              </div>
              </div>


            </div>

            <!-- Pit Scouting Tab -->
            <div class="tab-pane" id="nav-pit" role="tabpanel" aria-labelledby="nav-pit-tab" tabindex="0">
              <form class="mt-2" id="pitScoutingForm">
                <div class="d-flex w-100 justify-content-around">
                  <div class="mx-2">
                    <div class="mb-2">
                      <label class="form-label" for="pitTeamNumber">Team #<span class="text-danger">*</span></label>
                      <input class="form-control" type="tel" name="pitTeamNumber" id="pitTeamNumber" placeholder="" value="" autocomplete="off">
                    </div>
                                      <!-- 
                      Can you interact with the charger during auton? -->
                    <div class="mb-2">
                      <label class="form-label" for="pitAutonCharger">Auton Charger?</label>
                      <select class="form-select" name="pitAutonCharger" id="pitAutonCharger">
                        <option value="" selected disabled class="text-secondary"></option>
                        <option value="docked" class="text-black">Docked</option>
                        <option value="engaged" class="text-black">Engaged</option>
                        <option value="no" class="text-black">No</option>
                      </select>
                    </div>

                    <div class="mb-2">
                      <label class="form-label" for="pitTeleopCharger">Teleop Charger?</label>
                      <select class="form-select" name="pitTeleopCharger" id="pitTeleopCharger">
                        <option value="" selected disabled class="text-secondary"></option>
                        <option value="docked" class="text-black">Docked</option>
                        <option value="engaged" class="text-black">Engaged</option>
                        <option value="no" class="text-black">No</option>
                      </select>
                    </div>
                      
                    <!-- How many game pieces can you score during auton?-->
                    <div class="mb-2">
                      <label class="form-label" for="pitNumGamePieces"># Game Pieces during Auton</label>
                      <input class="form-control" type="tel" name="pitNumGamePieces" id="pitNumGamePieces" placeholder="" value="" autocomplete="off">
                    </div>

                    <!-- Drivetrain -->
                    <div class="mb-2">
                      <label class="form-label" for="pitDrivetrain">What's your drivetrain?</label>
                      <select class="form-select" name="pitDrivetrain" id="pitDrivetrain">
                        <option value="" selected disabled class="text-secondary"></option>
                        <option value="swerve" class="text-black">Swerve</option>
                        <option value="tank" class="text-black">Tank</option>
                        <option value="omni-h-drive" class="text-black">Omni/H-Drive</option>
                        <option value="mecanum" class="text-black">Mecanum</option>
                        <option value="other" class="text-black">other</option>
                      </select>
                      <input type="text" class="form-control mt-1" placeholder="Other" aria-label="other drivetrain" id="otherDrivetrain" style="display:none;">
                    </div>
                  </div>
                  <div class="mx-2">
                    <!-- Do you do cones cubes or both? -->
                    <div class="mb-2">
                      <label class="form-label" for="pitTypeGamePiece">What game pieces can you score?</label>
                      <select class="form-select" name="pitTypeGamePiece" id="pitTypeGamePiece">
                        <option value="" selected disabled class="text-secondary"></option>
                        <option value="cone" class="text-black">Cone</option>
                        <option value="cube" class="text-black">Cube</option>
                        <option value="both" class="text-black">Both</option>
                      </select>
                    </div>

                    <!-- Best Game piece -->
                    <div class="mb-2">
                      <label class="form-label" for="pitBestGamePiece">Best game piece?</label>
                      <select class="form-select" name="pitBestGamePiece" id="pitBestGamePiece">
                        <option value="" selected disabled class="text-secondary"></option>
                        <option value="cone" class="text-black">Cone</option>
                        <option value="cube" class="text-black">Cube</option>
                        <option value="both" class="text-black">Both</option>
                      </select>
                    </div>

                    <div class="mb-2">
                      <label class="form-label" for="pitProgramLang">What Programming language?</label>
                      <input class="form-control" type="text" name="pitProgramLang" id="pitProgramLang" placeholder="" value="" autocomplete="off">
                    </div>

                    <div class="mb-2">
                      <label class="form-label" for="pitOrientGamepieces">How do you orient game pieces?</label>
                      <input class="form-control" type="text" name="pitOrientGamepieces" id="pitOrientGamepieces" placeholder="" value="" autocomplete="off">
                    </div>

                    <div class="mb-2">
                      <label class="form-label" for="pitBestGamePiece">Human player preffered substation</label>
                      <select class="form-select" name="pitBestGamePiece" id="pitBestGamePiece">
                        <option value="" selected disabled class="text-secondary"></option>
                        <option value="cone" class="text-black">Single</option>
                        <option value="cube" class="text-black">Double</option>
                        <option value="both" class="text-black">Either</option>
                      </select>
                    </div>


                  </div>
                </div>

                <div class="form-floating my-2 mx-4 ">
                  <textarea class="form-control" placeholder="Leave a comment here" id="pitComments" style="height: 100px"></textarea>
                  <label for="pitComments">Comments</label>
                </div>

                <div class="d-flex justify-content-around my-2">
                  <button class="btn btn-primary" onclick="resetPitScout()"; id="resetPitScout">Reset</button>
                  <button class="btn btn-primary" type="submit" id="savePitScout">Save</button>
                </div>
              </form>
              
            </div>

            <!-- Saved Tab -->
            <div class="tab-pane " id="nav-matches" role="tabpanel" aria-labelledby="nav-matches-tab" tabindex="0">
              <div class="mt-4">
                <h4>Saved Matches</h4>
                <div class="list-group mt-4" id="savedMatchesList">
              </div>
              </div>
            </div>

            <!-- Transfer Tab -->
            <div class="tab-pane " id="nav-transfer" role="tabpanel" aria-labelledby="nav-transfer-tab" tabindex="0">
              <div class="btn-group w-100 mt-2" role="group" aria-label="Basic radio toggle button group" id="transfer_choice">
                <input type="radio" class="btn-check" name="transfer_choice" id="transfer_send" value="Send" autocomplete="off" checked>
                <label class="btn btn-outline-danger  flex-fill " for="transfer_send">Send</label>
                <input type="radio" class="btn-check" name="transfer_choice" id="transfer_receive" value="Receive" autocomplete="off">
                <label class="btn btn-outline-danger flex-fill " for="transfer_receive">Receive</label>
              </div>
              <div class="send-data-section mt-2" id="send-data-section">
                <div class="d-flex justify-content-between">
                  <div class="w-100 pe-2">
                    <div class="btn-group w-100" role="group" aria-label="Basic radio toggle button group" id="send_choice">
                      <input type="radio" class="btn-check" name="send_choice" id="transfer_send_matches" value="SendMatches" autocomplete="off" checked>
                      <label class="btn btn-outline-primary  flex-fill " for="transfer_send_matches">Matches</label>
                      <input type="radio" class="btn-check" name="send_choice" id="transfer_send_pits" value="SendPits" autocomplete="off">
                      <label class="btn btn-outline-primary flex-fill " for="transfer_send_pits">Pits</label>
                    </div>
                    <div id="send-list-section">
                      <div class="send-matches-section" id="send-matches-section">
                        <h4>Matches Needing Transfer</h4>
                        <div class="list-group mt-4 text-left" id="sendSavedMatchesList"></div>
                      </div>
                      <div class="send-pits-section" style="display:none!important" id="send-pits-section">
                        <h4>Pit Info Needing Transfer</h4>
                        <div class="list-group mt-4 text-left" id="sendSavedPitsList"></div>
                      </div>
                    </div>
                    <div class="mt-4 text-center" id="qrCodeSection" style="display:none;">
                      <!-- <button class="btn btn-primary" onClick="generateQRCode('qrCodeBlock',{name:'test'})">Generate test QR Code</button> -->
                      <div class="text-center mt-2" id="qrCodeBlock">

                      </div>
                      <div class="text-center my-2" id="numTransferInfo" style="display:none!important">
                        <div class=" d-flex justify-content-around ">
                          <div><button class="btn btn-primary" id="qrPrevBtn" style="display:none">Prev</button></div>
                          <div>QR Code (<span id="currentQrCode"></span> of <span id="numQrCodes"></span>)</div>
                          <div><button class="btn btn-primary" id="qrNextBtn">Next</button></div>
                        </div>
                      </div>
                    </div>
                    <div class="text-center d-flex flex-end mt-2">
                      <button class="btn btn-primary" onClick="backToSelectTransfer()"  id="generateQrCodeBackBtn" style="display:none;">Back</button>
                      <button class="btn btn-danger ms-auto" id="doneTransferBtn" style="display:none">Finished</button>
                      <button class="btn btn-primary ms-auto" onClick="showQRCodeForMatches()"  id="generateQrCodeBtn" disabled>Generate QR Code</button>
                    </div>
                  </div>
                </div>

              </div>
              <div class="recieve-data-section mt-4 text-center" id="receive-data-section" style="display:none">
                Receive
                <button class="btn btn-primary" id="initCameraScanning">Start Scanning</button>
                <button class="btn btn-primary" id="stopCameraScanning">Stop Scanning</button>
                <div id="reader"  width="20rem" height="20rem"></div>
              </div>

            </div>

            <div class="tab-pane" id="nav-analyze" role="tabpanel" aria-labelledby="nav-analyze-tab" tabindex="0">
              <div>
                Analyze Data  
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    
    <script src="js/jquery-3.6.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/umd.js"></script>
    <script src="js/qrcode.js"></script>
    <script src="js/html5-qrcode.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/database.js"></script>

    <!-- Current Match data -->
    <script>
      var currentMatchData = {};

      $().ready(function(){
        $('#scout_name').val(getCookie('scout_name') || '');
        $('#matchType').val(getCookie('matchType') || '');
        validateScoutName()

        initData()
      });

      function validateScoutName(){
        if($('#scout_name').val() !== "" && $('#scout_name').val() !== null){
          $('#startScouting').prop('disabled', false);
          $('#pitScouting').prop('disabled', false);
          $('#nav-record-tab').prop('disabled', false);
          $('#nav-pit-tab').prop('disabled', false);
        }
      }

      $('#scout_name').on('keyup', function(){
        validateScoutName()
      });

      $('#scout_name').change(function(){
        validateScoutName()
        setCookie('scout_name', $('#scout_name').val(), 4);
        
      });

      $('#matchType').change(function(){
        if($('#matchType').find(":selected").is(":disabled")){
          $('#matchType').addClass("text-secondary");
        }else{
          $('#matchType').removeClass("text-secondary");
          setCookie('matchType', $('#matchType').val(), 4);
        }
      });

      function initData(){
        $('#matchType').val(getCookie('matchType') || '');
        currentMatchData['mobility'] = $("#mobility").is(':checked');
        currentMatchData['defensive'] = $("#teleop_defensive").is(':checked');
        currentMatchData['auton_charger'] = $('input[name=auton_charger]:checked', "#auton_charger_container").val();
        currentMatchData['teleop_charger'] = $('input[name=teleop_charger]:checked', "#teleop_charger_container").val();
        currentMatchData['auton_bottom'] = 0;
        currentMatchData['auton_middle_cone'] = 0;
        currentMatchData['auton_top_cone'] = 0;
        currentMatchData['auton_middle_cube'] = 0;
        currentMatchData['auton_top_cube'] = 0;
        currentMatchData['teleop_bottom'] = 0;
        currentMatchData['teleop_middle_cone'] = 0;
        currentMatchData['teleop_top_cone'] = 0;
        currentMatchData['teleop_middle_cube'] = 0;
        currentMatchData['teleop_top_cube'] = 0;
        currentMatchData['teleop_pickup_portal_slide'] = 0;
        currentMatchData['teleop_pickup_portal_shelf'] = 0;
        currentMatchData['teleop_pickup_ground'] = 0;
        currentMatchData['events'] = [];

      }

      function saveScoutName(){
        currentMatchData['scout'] = $('#scout_name').val();
      }
      
      function saveInfo(){
        currentMatchData['scout'] = $('#scout_name').val();
        currentMatchData['date'] = $('#matchDate').val()
        currentMatchData['type'] = $('#matchType').val();
        currentMatchData['match_number'] = $('#matchNumber').val();
        currentMatchData['team_number'] = $('#teamNumber').val();
        if($("#allianceSwitch").is(':checked')){
          currentMatchData['alliance'] = "red"
        } else {
          currentMatchData['alliance'] = "blue"
        }
      }

      $('#mobility').change(function(){
        currentMatchData['mobility'] = $("#mobility").is(':checked');

      });

      $('input[name=auton_charger]').change(function(){
        currentMatchData['auton_charger'] = $('input[name=auton_charger]:checked', "#auton_charger_container").val();
        addEvent('auton_charger: ' + $('input[name=auton_charger]:checked', "#auton_charger_container").val());

      });

      $('#auton_bot').click(function(){
        currentMatchData['auton_bottom'] += 1;
        addEvent('auton_bottom');

      });
      $('#auton_mid_cube').click(function(){
        currentMatchData['auton_middle_cube'] += 1;
        addEvent('auton_middle_cube');
      });
      $('#auton_top_cube').click(function(){
        currentMatchData['auton_top_cube'] += 1;
        addEvent('auton_top_cube');
      });
      $('#auton_mid_cone').click(function(){
        currentMatchData['auton_middle_cone'] += 1;
        addEvent('auton_middle_cone');

      });
      $('#auton_top_cone').click(function(){
        currentMatchData['auton_top_cone'] += 1;
        addEvent('auton_top_cone');

      });

      $('#teleop_defensive').change(function(){
        currentMatchData['defensive'] = $("#teleop_defensive").is(':checked');
      });

      $('input[name=teleop_charger]').change(function(){
        currentMatchData['teleop_charger'] = $('input[name=teleop_charger]:checked', "#teleop_charger_container").val();
        addEvent('teleop_charger: '+ $('input[name=teleop_charger]:checked', "#teleop_charger_container").val());

      });

      $('#teleop_pickup_portal_slide').click(function(){
        currentMatchData['teleop_pickup_portal_slide'] += 1;
        addEvent('teleop_pickup_portal_slide');
      });
      $('#teleop_pickup_portal_shelf').click(function(){
        currentMatchData['teleop_pickup_portal_shelf'] += 1;
        addEvent('teleop_pickup_portal_shelf');
      });
      $('#teleop_pickup_ground').click(function(){
        currentMatchData['teleop_pickup_ground'] += 1;
        addEvent('teleop_pickup_ground');
      });

      $('#teleop_bot').click(function(){
        currentMatchData['teleop_bottom'] += 1;
        addEvent('teleop_bottom');
      });
      $('#teleop_mid_cone').click(function(){
        currentMatchData['teleop_middle_cone'] += 1;
        addEvent('teleop_middle_cone');
      });
      $('#teleop_top_cone').click(function(){
        currentMatchData['teleop_top_cone'] += 1;
        addEvent('teleop_top_cone');
      });
      $('#teleop_mid_cube').click(function(){
        currentMatchData['teleop_middle_cube'] += 1;
        addEvent('teleop_middle_cube');
      });
      $('#teleop_top_cube').click(function(){
        currentMatchData['teleop_top_cube'] += 1;
        addEvent('teleop_top_cube');
      });

      function addEvent(type){
        var newEvent ={
          type: type,
          time: new Date()
        };
        currentMatchData['events'].push(newEvent);
      }



      function saveRecording(){
        currentMatchData['comments'] = $('#comments').val();
        currentMatchData['recorded_date'] = new Date();
        currentMatchData['transfered'] = 0;
        addMatch(currentMatchData);

        currentMatchData = {};
        $('#matchType').val("");
        $('#matchNumber').val("");
        $('#teamNumber').val("");
        $('input[name=endgame_charger]').prop('checked',false);
        $('input[name=auton_charger]').prop('checked',false);
        $('input[name=mobility]').prop('checked',false);
        $('input[name=defensive]').prop('checked',false);
        restartTimer();


        showInfo();
        initData();
        //$('#nav-matches-tab' ).trigger('click');
      }

    </script>

    <!--Pit Scouting -->
    <script>
      $('#pitDrivetrain').change(function(){
        if($('#pitDrivetrain').val() == "other"){
          $('#otherDrivetrain').show()
        } else{
          $('#otherDrivetrain').hide()
          
        }
      })

      $('#pitScoutingForm').submit(function(event){
        event.preventDefault();
        if($('#pitTeamNumber').val() == ""){alert("Enter a team number");return;}
        let value = $(('#pitScoutingForm')).serializeArray();
        value.push({name:"pitComments",value:$('#pitComments').val()});
        value.push({name:"recorded_date",value:new Date()});
        value.push({name:"type",value:"pit"});
        addPit(value);
        resetPitScout();
      });

      function resetPitScout(){
        $('#pitScoutingForm')[0].reset();
      }

      $('#transfer_send_pits').click(function(){
        $('#send-pits-section').show();
        $('#send-matches-section').hide();
      })

      $('#transfer_send_matches').click(function(){
        $('#send-matches-section').show();
        $('#send-pits-section').hide();
      })
    </script>

    <!-- All Timings & UI Stuff -->
    <script>
      // Constants of durations of match events
      const autoDuration = 15;
      const autoEnd = 3;
      const teleopDuration = 105;
      const endgameDuration = 30;
      const totalDuration = autoDuration + autoEnd + teleopDuration + endgameDuration;

      var timerPaused = false;
      var timerPausedAt;
      var timerTotalPausedAt;
      var currentMatchTime;

      var validMatchInfo = false;
      

      $().ready(function(){
        $('#matchDate').val(new Date().toISOString().slice(0, 10) );

        if($('#matchType').find(":selected").is(":disabled")){
          $('#matchType').addClass("text-secondary");
        }else{
          $('#matchType').removeClass("text-secondary");
        }
      });

      $('#matchType,#matchNumber,#teamNumber').change(function(){
        validateMatchInfo();
      })

      function validateMatchInfo(){
        validMatchInfo = true;
        if($('#matchType').val() == "" || $('#matchType').val() == null){validMatchInfo = false;}
        if($('#matchNumber').val() == "" || $('#matchNumber').val() == null && $('#matchNumber').val() > 0){validMatchInfo = false;}
        if($('#teamNumber').val() == "" || $('#teamNumber').val() == null && $('#teamNumber').val() > 0){validMatchInfo = false;}

        if(validMatchInfo){$('#continueMatchInfo').prop('disabled', false)} else { $('#continueMatchInfo').prop('disabled', true);}


      }


      function showAuton(){
        $('.timer-section').show();
        $('#record-info').hide();
        $('#record-teleop').hide();
        $('#record-auton').show();

        saveInfo();
      }

      function showTeleop(){
        $('#record-info').hide();
        $('#record-auton').hide();
        $('#record-teleop').show();
      }

      function showInfo(){
        $('.timer-section').hide();
        $('#record-auton').hide();
        $('#record-teleop ').hide();
        $('#record-info').show();
      }

      function startTimer(){
        // initData(); When should we set everything to 0?

        $('.countdown').show();
        $('#startTimer').hide();
        $('#stopTimer').show();
        $("#restartRecording").show();

        timerPaused = false;
        progress(totalDuration, totalDuration, $('#progressBar'));
        //  startAutoTimer();
      //  autoEndTimer();
      //  teleopTimer();
      //  endgameTimer();
      }

      function stopTimer(){
        timerPaused = true;
        $('#stopTimer').hide();
        $("#resumeTimer").show();
      }
      function resumeTimer(){
        timerPaused = false;
        $("#resumeTimer").hide();
        $('#stopTimer').show();

        progress(timerPausedAt, timerTotalPausedAt, $('#progressBar'));
      }

      function restartTimer(){
        timerPaused = true;
        timerPausedAt = 0
        timerTotalPausedAt = 0
        $("#restartRecording").hide();
        $('.countdown').hide();
        $('#stopTimer').hide();
        $("#resumeTimer").hide();
        $('#startTimer').show();
      }

      function progress(timeleft, timetotal, $element) {
        if(!timerPaused){
          var progressBarWidth = timeleft * $element.width() / timetotal;
          $element.find('div').animate({ width: progressBarWidth }, 500);
          $("#countdownTime").html(Math.floor(timeleft/60) + ":"+ pad(timeleft%60, 2));
          currentMatchTime = timetotal - timeleft;

          if(timeleft > (totalDuration - autoDuration)){
            $('#currentMatchPeriod').html("AUTONOMOUS")
          } else if(timeleft > (totalDuration - autoDuration - autoEnd)){
            $('#currentMatchPeriod').html("AUTONOMOUS SCORING")
          } else if(timeleft > (totalDuration - autoDuration - autoEnd - teleopDuration)){
            $('#currentMatchPeriod').html("TELEOPERATED")
          } else if(timeleft > 0){
            $('#currentMatchPeriod').html("ENDGAME")
          } else {
            $('#currentMatchPeriod').html("MATCH OVER")
          }

          if(timeleft > 0) {
              setTimeout(function() {
                  progress(timeleft - 1, timetotal, $element);
              }, 1000);
          }
        } else {
          timerPausedAt = timeleft;
          timerTotalPausedAt = timetotal;
          return;
        }
      };


    </script>

    <!-- Saved Tab -->
    <script>
      var savedTabPanel = document.getElementById("nav-matches-tab");
      savedTabPanel.addEventListener('shown.bs.tab', function(event){
        populateMatchesList('savedMatchesList');

      });

    </script>

    <!-- Send Transfer Tab -->
    <script>

      var dataToTransfer = {};
      var matchesNotTransfered = {};
      var pitNotTransfered = {};
      var splitDataToTransfer = [];
      var currQrCode = 0;

      var transferTabPanel = document.getElementById("nav-transfer-tab");
      transferTabPanel.addEventListener('shown.bs.tab', function(event){
        populateTransferList('sendSavedMatchesList');
        // populateTransferPitList('sendSavedPitsList');

      });

      $('#transfer_send').click(function(){
        $('#receive-data-section').hide()
        $('#send-data-section').show()
      })
      $('#transfer_receive').click(function(){
        $('#send-data-section').hide()
        $('#receive-data-section').show()
      })

      function generateQRCodeToTransfer(){
        generateQRCode('qrCodeBlock', dataToTransfer);
      }

      function handleTransferCheckbox(ele,id){
        if($(ele).prop("checked")){
          dataToTransfer[id] = matchesNotTransfered[id];
          console.log(dataToTransfer)
        } else {
         delete dataToTransfer[id];
        }



        if(Object.keys(dataToTransfer).length > 0){
          $('#generateQrCodeBtn').prop('disabled', false);
        } else {
          $('#generateQrCodeBtn').prop('disabled', true);
        }


      }

      function backToSelectTransfer(){
        $('#generateQrCodeBackBtn').hide()
        $('#qrCodeSection').hide()
        $('#send-list-section').show()
        $('#generateQrCodeBtn').show()
        $('#doneTransferBtn').hide()

      }

      function showQRCodeForMatches(){

        $('#send-list-section').hide()
        $('#generateQrCodeBtn').hide()
        $('#generateQrCodeBackBtn').show()
        $('#qrCodeSection').show()
        $('#qrNextBtn').show();
        $('#qrPrevBtn').hide();
        currQrCode = 0;

        splitDataToTransfer = [];
        let stringifiedData = JSON.stringify(dataToTransfer);
        if(stringifiedData.length > maxQRCodeStrLen){
          let storedStrLen = 0;
          while(storedStrLen < stringifiedData.length){
            splitDataToTransfer.push(stringifiedData.slice(storedStrLen, storedStrLen+maxQRCodeStrLen));
            storedStrLen += maxQRCodeStrLen;
            //allow to click through qr codes
          }

          $('#numQrCodes').html(splitDataToTransfer.length)
          $('#numTransferInfo').show();
          $('#currentQrCode').html(1)
          generateQRCode(splitDataToTransfer[0]);
        } else {
          generateQRCode(stringifiedData);
        }

        $('#generateQrCodeBtn').prop('disabled', true);
        $('#doneTransferBtn').show()


      }

      $('#qrPrevBtn').click(function(){
        let prevQRCode = --currQrCode;
        let displayQrCode =prevQRCode+1;
        $('#currentQrCode').html(displayQrCode)
        generateQRCode(splitDataToTransfer[prevQRCode]);

        if(currQrCode == 0){
          $('#qrPrevBtn').hide();
        }
        
        $('#qrNextBtn').show();

      });
      $('#qrNextBtn').click(function(){
        let nextQRCode = ++currQrCode;
        let displayQrCode = nextQRCode+1;
        $('#currentQrCode').html(displayQrCode)
        generateQRCode(splitDataToTransfer[nextQRCode]);

        if(currQrCode == splitDataToTransfer.length-1){
          $('#qrNextBtn').hide();
        }
        
        $('#qrPrevBtn').show();


      });
      $('#doneTransferBtn').click(function(){
        if(confirm("Are you sure you're done transfering?")){
          //markMatchesAsTransfered()
          let promiseArr = Object.keys(dataToTransfer).map(function(key){
            dataToTransfer[key]['transfered'] = 1;
            return updateMatch(key, dataToTransfer[key]).then(function(res){
              
              return res;
            })
          })

          Promise.all(promiseArr).then(function(resultsArray){
            qrcode.clear();
            Object.keys(dataToTransfer).forEach(function(key){
              $('#transferMatch_' + key).remove();
            })
            dataToTransfer = [];
            $('#qrCodeBlock').html("");
            $('#doneTransferBtn').hide();
            $('#numTransferInfo').hide();
            $('#generateQrCodeBtn').prop('disabled', false);
            
            populateTransferList();
          })
        }
      });

    </script>

    <!-- QRCode Scanning -->
    <!-- https://github.com/mebjas/html5-qrcode#pro-mode---if-you-want-to-implement-your-own-user-interface -->
    <script>
      function onScanSuccess(decodedText, decodedResult) {
        // handle the scanned code as you like, for example:
        console.log(`Code matched = ${decodedText}`, decodedResult);
        html5QrcodeScanner.stop().then((ignore) => {
          // QR Code scanning is stopped.
        }).catch((err) => {
          // Stop failed, handle it.
        });
      }
      
      function onScanFailure(error) {
        // handle scan failure, usually better to ignore and keep scanning.
        // for example:
        console.warn(`Code scan error = ${error}`);
      }
      
      //let html5QrcodeScanner = new Html5QrcodeScanner(
      //  "reader",
      //  { fps: 10, qrbox: {width: 250, height: 250} },
      //  /* verbose= */ false);
      //html5QrcodeScanner.render(onScanSuccess, onScanFailure);


      $('#initCameraScanning').click(function(){
        requestCamera();
      })

      $('#stopCameraScanning').click(function(){
        stopCamera();
      })

      // Custom code now::
      // This method will trigger user permissions
      const html5QrCode = new Html5Qrcode(/* element id */ "reader");

      function requestCamera(){
        Html5Qrcode.getCameras().then(devices => {
          /**
           * devices would be an array of objects of type:
           * { id: "id", label: "label" }
           */
          if (devices && devices.length) {
            var cameraId = devices[0].id;
            // .. use this to start scanning.

            html5QrCode.start(
              cameraId, 
              {
                fps: 10,    // Optional, frame per seconds for qr code scanning
                qrbox: { width: 250, height: 250 }  // Optional, if you want bounded box UI
              },
              (decodedText, decodedResult) => {
                // do something when code is read
              },
              (errorMessage) => {
                // parse error, ignore it.
              })
            .catch((err) => {
              // Start failed, handle it.
});
          }
        }).catch(err => {
          // handle err
        });
      }

      function stopCamera(){
        html5QrCode.stop().then((ignore) => {
          // QR Code scanning is stopped.
        }).catch((err) => {
          // Stop failed, handle it.
        });
      }


    </script>

    
    <!-- Helper Functions -->
    <script>
      var qrcode; // QRCode OBJ
      const maxQRCodeStrLen = 800;

      function setCookie(cName, cValue, expHours) {
        let date = new Date();
        date.setTime(date.getTime() + (expHours * 60 * 60 * 1000));
        const expires = "expires=" + date.toUTCString();
        document.cookie = cName + "=" + cValue + "; " + expires + "; path=/";
      }  

      function deleteCookie(cName) {
        const expires = "expires=Thu, 01 Jan 1970 00:00:00 UTC";
        document.cookie = cName + "=" + expires + "; path=/";
      }  

      function getCookie(cName) {
        const name = cName + "=";
        const cDecoded = decodeURIComponent(document.cookie); //to be careful
        const cArr = cDecoded.split('; ');
        let res;
        cArr.forEach(val => {
            if (val.indexOf(name) === 0) res = val.substring(name.length);
        })
        return res;
  }
      
      function pad(num, size){     return ('000000000' + num).substr(-size); }

      $().ready(function(){
        qrcode = new QRCode('qrCodeBlock',{
          height:512,
          width:512
        });
      })


      function generateQRCode(data){
        qrcode.clear(); 
        if(data.length <= 217 && data.length >= 192){data+="                          ";}
        qrcode.makeCode(data)
      }

      function populateMatchesList(eleId, showCheckboxes){
        getAllMatches().then(data =>{
          if(data.length == $("#" + eleId).children().length){return;}else{$('#'+eleId).html("")}
          let sortedData = data.sort(
            (p1, p2) => (p1.recorded_date < p2.recorded_date) ? 1 : (p1.recorded_date > p2.recorded_date) ? -1 : 0);
          data.forEach(match => {
              var divStr = '<div class="list-group-item text-align-left">' +
                  '<div class="d-flex">';

                divStr += '<div>Team ' + match.team_number + '</div>'+
                    '<div class="mx-2"> - </div>' + 
                    '<div>'+match.type+': ' + match.match_number + '</div>' +
                  '</div>'+
                  '<div class="text-secondary">'+match.date+'</div>'+ 
                  '</div>';
                $('#'  +eleId).append(divStr);
          })

        })
      }

      function populateTransferPitList(eleId){
        getAllPitsIndexed('transfered',0).then(data =>{
          if(data.length == $("#" + eleId).children().length){return;}else{$('#'+eleId).html("")}
          let sortedData = data.sort(
            (p1, p2) => (p1.recorded_date < p2.recorded_date) ? 1 : (p1.recorded_date > p2.recorded_date) ? -1 : 0);
          data.forEach(pit => {
            pitNotTransfered[pit.id] = pit;
              var divStr = '<div class="list-group-item text-align-left" id="transferMatch_'+pit.id+'">' +
                  '<div class="form-check" >'+
                    '<input class="form-check-input transferMatchCheckbox" type="checkbox" value="'+pit.id+'" onclick="handleTransferCheckbox(this, '+match.id+')">' +
                    '<label class="w-100" for="transferMatch_'+pit.id+'">'+
                      '<div class="d-flex">' +
                        '<div>Team ' + pit.team_number + '</div>'+
                      '</div>'+
                    '</label>'+
                  '</div>' +
                '</div>';
                $('#'  +eleId).append(divStr);
          })

        })
      }
      function populateTransferList(eleId){
        getAllMatchesIndexed('transfered',0).then(data =>{
          if(data.length == $("#" + eleId).children().length){return;}else{$('#'+eleId).html("")}
          let sortedData = data.sort(
            (p1, p2) => (p1.recorded_date < p2.recorded_date) ? 1 : (p1.recorded_date > p2.recorded_date) ? -1 : 0);
          data.forEach(match => {
            if($.isArray(match)){console.log(match); newMatch = Object.fromEntries(match.entries());console.log(newMatch)}
            matchesNotTransfered[match.id] = match;
            
              var divStr = '<div class="list-group-item text-align-left" id="transferMatch_'+match.id+'">' +
                  '<div class="form-check" >'+
                    '<input class="form-check-input transferMatchCheckbox" type="checkbox" value="'+match.id+'" id="matchCheck_'+match.id+'" name="matchCheck_'+match.id+'"onclick="handleTransferCheckbox(this, '+match.id+')">' +
                    '<label class="form-check-label" for="matchCheck_'+match.id+'">'+
                      '<div class="d-flex">' +
                        '<div>Team ' + match.team_number + '</div>'+
                        '<div class="mx-2"> - </div>' + 
                        '<div>'+match.type+': ' + match.match_number + '</div>' +
                      '</div>'+
                      '<div class="text-secondary">'+match.date+'</div>'+ 
                      '<div class="text-secondary">'+match.id+'</div>'+ 
                    '</label>'+
                  '</div>' +
                '</div>';
                $('#'  +eleId).append(divStr);
          })

        })
      }

    </script>

  </body>
</html>
